<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/navigation.js"></script>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/student.css">
  <link rel="stylesheet" href="styles/navigation.css">
</head>
<body>
  <div class="container role-student">
    <!-- –•–µ–¥–µ—Ä —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
    <div class="student-header">
      <h1><span class="emoji">üßë‚Äçüéì</span>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
      <div class="student-info" id="studentHeaderInfo">
        –ó–∞–≥—Ä—É–∑–∫–∞...
      </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <div id="navigation-container"></div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let currentStudent = null;
    let navigation = null;
    let auth = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞...');
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram WebApp
      if (window.Telegram?.WebApp) {
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
      }
      
      try {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é - —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        auth = new AuthSystem();
        const user = await auth.init(['student'], onAuthSuccess, onAuthFail);
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
      }
    });

    // –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    function onAuthSuccess(user) {
      console.log('‚úÖ –°—Ç—É–¥–µ–Ω—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', user);
      
      currentStudent = user;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—É–¥–µ–Ω—Ç–µ –≤ —Ö–µ–¥–µ—Ä–µ
      updateStudentHeaderInfo(user);
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
      initializeNavigation(user);
    }

    // –ù–µ—É–¥–∞—á–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    function onAuthFail(error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞:', error);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    function initializeNavigation(user) {
      navigation = initNavigation(user, 'navigation-container');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã —Å–µ–∫—Ü–∏–π
      document.addEventListener('navigation:sectionChange', handleSectionChange);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      setTimeout(() => {
        loadInitialData();
      }, 100);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ç—É–¥–µ–Ω—Ç–µ –≤ —Ö–µ–¥–µ—Ä–µ
    function updateStudentHeaderInfo(user) {
      const headerInfo = document.getElementById('studentHeaderInfo');
      if (headerInfo) {
        const languages = Array.isArray(user.languages) 
          ? user.languages.join(' & ') 
          : (user.languages || '–ù–µ —É–∫–∞–∑–∞–Ω');
          
        headerInfo.innerHTML = `
          ${user.name} ‚Ä¢ ${languages}
          ${user.next_session ? `
            <small style="display: block; opacity: 0.9; margin-top: 4px;">
              –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫: ${user.next_session.date}
            </small>
          ` : ''}
        `;
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    async function loadInitialData() {
      console.log('üìä –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–∞...');
      
      try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ–∫—Ü–∏–∏
        const currentSection = navigation.getCurrentSection();
        await loadSectionContent(currentSection);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã —Å–µ–∫—Ü–∏–∏
    function handleSectionChange(event) {
      const { sectionId } = event.detail;
      console.log('üìç –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å–µ–∫—Ü–∏—é:', sectionId);
      
      loadSectionContent(sectionId);
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–µ–∫—Ü–∏–∏
    async function loadSectionContent(sectionId) {
      console.log('üìö –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —Å–µ–∫—Ü–∏–∏:', sectionId);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
      navigation.setSectionLoading(sectionId, true);
      
      try {
        let content = '';
        
        switch (sectionId) {
          case 'overview':
            content = await loadOverviewContent();
            break;
          case 'lessons':
            content = await loadLessonsContent();
            break;
          case 'vocabulary':
            content = await loadVocabularyContent();
            break;
          case 'progress':
            content = await loadProgressContent();
            break;
          case 'homework':
            content = await loadHomeworkContent();
            break;
          default:
            content = `<div class="empty-state">
              <div class="placeholder-icon">üöß</div>
              <h3>–°–µ–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3>
              <p>–ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Å–µ–∫—Ü–∏–∏ "${sectionId}" –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ</p>
            </div>`;
        }
        
        navigation.updateSectionContent(sectionId, content);
        
      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ–∫—Ü–∏–∏ ${sectionId}:`, error);
        navigation.setSectionError(sectionId, error.message);
      }
    }

    // ===== –ó–ê–ì–†–£–ó–ß–ò–ö–ò –ö–û–ù–¢–ï–ù–¢–ê –°–ï–ö–¶–ò–ô =====

    async function loadOverviewContent() {
      const stats = await loadStudentStats();
      
      return `
        <div class="overview-content">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number">${stats.totalLessons}</div>
              <div class="stat-label">–í—Å–µ–≥–æ —É—Ä–æ–∫–æ–≤</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">${stats.vocabularyWords}</div>
              <div class="stat-label">–°–ª–æ–≤ –≤ —Å–ª–æ–≤–∞—Ä–µ</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">${stats.completedHomework}</div>
              <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">${stats.studyStreak}</div>
              <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
            </div>
          </div>
          
          <div class="student-profile">
            <h3><span class="emoji">üë§</span>–ú–æ—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <div class="profile-info">
              <div class="info-row">
                <span class="info-label">–ò–º—è:</span>
                <span class="info-value">${currentStudent.name}</span>
              </div>
              ${currentStudent.email ? `
                <div class="info-row">
                  <span class="info-label">Email:</span>
                  <span class="info-value">${currentStudent.email}</span>
                </div>
              ` : ''}
              ${currentStudent.username ? `
                <div class="info-row">
                  <span class="info-label">Telegram:</span>
                  <span class="info-value">@${currentStudent.username}</span>
                </div>
              ` : ''}
              <div class="info-row">
                <span class="info-label">–Ø–∑—ã–∫–∏:</span>
                <span class="info-value">${Array.isArray(currentStudent.languages) ? currentStudent.languages.join(', ') : currentStudent.languages}</span>
              </div>
              ${currentStudent.preferred_time ? `
                <div class="info-row">
                  <span class="info-label">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º–æ–µ –≤—Ä–µ–º—è:</span>
                  <span class="info-value">${currentStudent.preferred_time}</span>
                </div>
              ` : ''}
              ${currentStudent.preferred_days && currentStudent.preferred_days.length > 0 ? `
                <div class="info-row">
                  <span class="info-label">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ –¥–Ω–∏:</span>
                  <span class="info-value">${currentStudent.preferred_days.join(', ')}</span>
                </div>
              ` : ''}
            </div>
          </div>

          ${currentStudent.next_session ? `
            <div class="next-lesson">
              <h3><span class="emoji">üìÖ</span>–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫</h3>
              <div class="lesson-card">
                <div class="lesson-time">${currentStudent.next_session.date}</div>
                <div class="lesson-details">
                  <div class="lesson-language">${currentStudent.next_session.language}</div>
                  <div class="lesson-type">${currentStudent.next_session.type}</div>
                </div>
                <button class="btn-primary" onclick="joinLesson()">
                  üìö –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —É—Ä–æ–∫—É
                </button>
              </div>
            </div>
          ` : `
            <div class="no-lessons">
              <h3><span class="emoji">üìÖ</span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
              <div class="empty-state">
                <p>–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤</p>
                <button class="btn-primary" onclick="bookLesson()">
                  üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–∫
                </button>
              </div>
            </div>
          `}
        </div>
      `;
    }

    async function loadLessonsContent() {
      const response = await auth.apiRequest(`/api/student-lessons?user_id=${currentStudent.id}`);
      
      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤: ${response.status}`);
      }
      
      const { lessons, grouped } = await response.json();
      
      return `
        <div class="lessons-content">
          <div class="section-header">
            <h3>–ú–æ–∏ —É—Ä–æ–∫–∏</h3>
            <button class="btn-primary" onclick="bookLesson()">
              üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–∫
            </button>
          </div>
          
          ${grouped.upcoming.length > 0 ? `
            <div class="lessons-group">
              <h4><span class="emoji">‚è∞</span>–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ —É—Ä–æ–∫–∏</h4>
              <div class="lessons-list">
                ${grouped.upcoming.map(lesson => `
                  <div class="lesson-item upcoming">
                    <div class="lesson-time">
                      <div class="date">${lesson.formatted_date}</div>
                      <div class="time">${lesson.formatted_time}</div>
                    </div>
                    <div class="lesson-info">
                      <div class="lesson-language">${lesson.display_language}</div>
                      <div class="lesson-type">${lesson.display_type}</div>
                      <div class="lesson-status">${lesson.display_status}</div>
                    </div>
                    <div class="lesson-actions">
                      ${lesson.can_join ? `
                        <button class="btn-primary" onclick="joinZoom('${lesson.zoom_link}')">
                          üé• –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                        </button>
                      ` : `
                        <span class="time-until">${lesson.time_until}</span>
                      `}
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}
          
          ${grouped.past.length > 0 ? `
            <div class="lessons-group">
              <h4><span class="emoji">üìö</span>–ü—Ä–æ—à–µ–¥—à–∏–µ —É—Ä–æ–∫–∏</h4>
              <div class="lessons-list">
                ${grouped.past.slice(0, 10).map(lesson => `
                  <div class="lesson-item past">
                    <div class="lesson-time">
                      <div class="date">${lesson.formatted_date}</div>
                      <div class="time">${lesson.formatted_time}</div>
                    </div>
                    <div class="lesson-info">
                      <div class="lesson-language">${lesson.display_language}</div>
                      <div class="lesson-status">${lesson.display_status}</div>
                    </div>
                    ${lesson.notes ? `
                      <div class="lesson-notes">${lesson.notes}</div>
                    ` : ''}
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}
          
          ${lessons.length === 0 ? `
            <div class="empty-state">
              <div class="placeholder-icon">üìö</div>
              <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —É—Ä–æ–∫–æ–≤</h3>
              <p>–ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ</p>
              <button class="btn-primary" onclick="bookLesson()">
                üìÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–∫
              </button>
            </div>
          ` : ''}
        </div>
      `;
    }

    async function loadVocabularyContent() {
      const response = await auth.apiRequest(`/api/vocab?user_id=${currentStudent.id}`);
      
      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–≤–∞—Ä—è: ${response.status}`);
      }
      
      const { words } = await response.json();
      
      const englishWords = words.filter(w => w.language === 'english');
      const frenchWords = words.filter(w => w.language === 'french');
      const studiedWords = words.filter(w => w.studied_count > 0);
      
      return `
        <div class="vocabulary-content">
          <div class="vocab-stats">
            <div class="stat-item">
              <span class="stat-number">${words.length}</span>
              <span class="stat-label">–í—Å–µ–≥–æ —Å–ª–æ–≤</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${englishWords.length}</span>
              <span class="stat-label">English</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${frenchWords.length}</span>
              <span class="stat-label">French</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${studiedWords.length}</span>
              <span class="stat-label">–ò–∑—É—á–µ–Ω–æ</span>
            </div>
          </div>
          
          ${words.length > 0 ? `
            <div class="recent-words">
              <h4><span class="emoji">üìù</span>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞</h4>
              <div class="words-list">
                ${words.slice(0, 10).map(word => `
                  <div class="word-item">
                    <div class="word-main">
                      <div class="word-text">${word.word}</div>
                      <div class="word-translation">${word.translation || '‚Äî'}</div>
                    </div>
                    <div class="word-meta">
                      ${word.language ? `<span class="language-badge ${word.language}">${word.language.toUpperCase()}</span>` : ''}
                      ${word.studied_count > 0 ? `<span class="studied-badge">‚úì ${word.studied_count}</span>` : ''}
                    </div>
                    <button class="action-btn" onclick="markWordStudied('${word.id}')">
                      ${word.studied_count > 0 ? '‚úì' : '–ò–∑—É—á–∏—Ç—å'}
                    </button>
                  </div>
                `).join('')}
              </div>
              
              <div class="vocab-actions">
                <a href="vocabulary.html?user_id=${encodeURIComponent(currentStudent.id)}" class="btn-secondary">
                  üìö –û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å
                </a>
              </div>
            </div>
          ` : `
            <div class="empty-state">
              <div class="placeholder-icon">üìö</div>
              <h3>–í–∞—à —Å–ª–æ–≤–∞—Ä—å –ø–æ–∫–∞ –ø—É—Å—Ç</h3>
              <p>–°–ª–æ–≤–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —É—Ä–æ–∫–æ–≤</p>
            </div>
          `}
        </div>
      `;
    }

    async function loadProgressContent() {
      const stats = await loadStudentStats();

      return `
        <div class="progress-content">
          <div class="progress-stats">
            <div class="stat-card">
              <div class="stat-number">${stats.totalLessons}</div>
              <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ —É—Ä–æ–∫–æ–≤</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">${stats.vocabularyWords}</div>
              <div class="stat-label">–ò–∑—É—á–µ–Ω–æ —Å–ª–æ–≤</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">${stats.studyStreak}</div>
              <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
            </div>
          </div>

          <div class="progress-sections">
            <div class="progress-section">
              <h4><span class="emoji">üìä</span>–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h4>
              <div class="progress-info">
                <p>–í—ã –ø—Ä–æ—à–ª–∏ <strong>${stats.totalLessons}</strong> —É—Ä–æ–∫–æ–≤ –∏ –∏–∑—É—á–∏–ª–∏ <strong>${stats.vocabularyWords}</strong> –Ω–æ–≤—ã—Ö —Å–ª–æ–≤.</p>
                ${stats.totalLessons > 0 ? `
                  <div class="achievement">
                    <span class="achievement-icon">üéâ</span>
                    <span>–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!</span>
                  </div>
                ` : `
                  <div class="motivation">
                    <span class="motivation-icon">üöÄ</span>
                    <span>–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ? –ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫!</span>
                  </div>
                `}
              </div>
            </div>

            <div class="progress-section">
              <h4><span class="emoji">üéØ</span>–ë–ª–∏–∂–∞–π—à–∏–µ —Ü–µ–ª–∏</h4>
              <div class="goals-list">
                <div class="goal-item">
                  <div class="goal-text">–ü—Ä–æ–π—Ç–∏ 5 —É—Ä–æ–∫–æ–≤</div>
                  <div class="goal-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: ${Math.min((stats.totalLessons / 5) * 100, 100)}%"></div>
                    </div>
                    <span class="progress-text">${stats.totalLessons}/5</span>
                  </div>
                </div>
                <div class="goal-item">
                  <div class="goal-text">–ò–∑—É—á–∏—Ç—å 50 —Å–ª–æ–≤</div>
                  <div class="goal-progress">
                    <div class="progress-bar">
                      <div class="progress-fill" style="width: ${Math.min((stats.vocabularyWords / 50) * 100, 100)}%"></div>
                    </div>
                    <span class="progress-text">${stats.vocabularyWords}/50</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    async function loadHomeworkContent() {
      return `
        <div class="homework-content">
          <div class="empty-state">
            <div class="placeholder-icon">‚úèÔ∏è</div>
            <h3>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h3>
            <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∏ –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</p>
            <p><small>–§—É–Ω–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</small></p>
          </div>
        </div>
      `;
    }

    // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

    async function loadStudentProfile() {
      try {
        const response = await auth.apiRequest(`/api/students`);
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        const { students } = await response.json();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º —Å—Ç—É–¥–µ–Ω—Ç–µ
        const studentData = students.find(s => s.id === currentStudent.id);
        if (studentData) {
          Object.assign(currentStudent, studentData);
          updateStudentHeaderInfo(currentStudent);
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞:', error);
      }
    }

    async function loadStudentStats() {
      try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        const [vocabRes, lessonsRes] = await Promise.all([
          auth.apiRequest(`/api/vocab?user_id=${currentStudent.id}`),
          auth.apiRequest(`/api/student-lessons?user_id=${currentStudent.id}&limit=100`)
        ]);

          if (!vocabRes.ok || !lessonsRes.ok) {
            throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞');
          }

        const { words = [] } = await vocabRes.json();
        const { lessons = [] } = await lessonsRes.json();
        
        const completedLessons = lessons.filter(l => l.status === 'completed');
        const studiedWords = words.filter(w => w.studied_count > 0);
        
        return {
          totalLessons: completedLessons.length,
          vocabularyWords: words.length,
          completedHomework: 0, // TODO: –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç API –¥–ª—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π
          studyStreak: 0 // TODO: –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å—á–µ—Ç –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
        };
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
        return {
          totalLessons: 0,
          vocabularyWords: 0,
          completedHomework: 0,
          studyStreak: 0
        };
      }
    }

    // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–ï–ô–°–¢–í–ò–ô =====

    function bookLesson() {
      const bookingUrl = 'https://calendar.app.google/SQGJj626MUyQ6DYL6';
      
      if (window.Telegram?.WebApp?.openLink) {
        window.Telegram.WebApp.openLink(bookingUrl);
      } else {
        window.open(bookingUrl, '_blank');
      }
    }

    function joinLesson() {
      showNotification('üéì –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —É—Ä–æ–∫—É –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    }

    function joinZoom(zoomLink) {
      if (zoomLink) {
        if (window.Telegram?.WebApp?.openLink) {
          window.Telegram.WebApp.openLink(zoomLink);
        } else {
          window.open(zoomLink, '_blank');
        }
      } else {
        showNotification('–°—Å—ã–ª–∫–∞ –Ω–∞ —É—Ä–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'warning');
      }
    }

    async function markWordStudied(wordId) {
      try {
        const response = await auth.apiRequest('/api/vocab', {
          method: 'PUT',
          body: JSON.stringify({ id: wordId, studied: true })
        });

        if (response.ok) {
          showNotification('‚úÖ –°–ª–æ–≤–æ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –∏–∑—É—á–µ–Ω–Ω–æ–µ', 'success');
          // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Ç–µ–∫—É—â–µ–π —Å–µ–∫—Ü–∏–∏
          loadSectionContent(navigation.getCurrentSection());
        } else {
          throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ —Å–ª–æ–≤–∞:', error);
        showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–ª–æ–≤–∞', 'error');
      }
    }

    // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'var(--success-color)' :
                     type === 'error' ? 'var(--error-color)' :
                     type === 'warning' ? '#ff9800' : 'var(--accent-color)'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        max-width: 300px;
        font-size: 13px;
        animation: slideInRight 0.3s ease-out;
        line-height: 1.4;
      `;

      if (!document.getElementById('notificationStyles')) {
        const style = document.createElement('style');
        style.id = 'notificationStyles';
        style.textContent = `
          @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
        `;
        document.head.appendChild(style);
      }

      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        if (document.body.contains(notification)) {
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => {
            if (document.body.contains(notification)) {
              document.body.removeChild(notification);
            }
          }, 300);
        }
      }, 3000);
    }

    console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
  </script>
</body>
</html>