<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Профиль ученика</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
      font-size: 14px;
      margin: 0.5rem;
      padding: 0;
      background: #fff;
      color: #202124;
    }

    h1, h2, h3 {
      font-size: 1.2rem;
      margin: 0.5rem 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      padding: 6px;
      border-bottom: 1px solid #e0e0e0;
      text-align: left;
      font-size: 13px;
    }

    th {
      background-color: #f1f3f4;
    }

    a {
      color: #007aff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    button {
      background: none;
      border: none;
      color: #007aff;
      font-size: 13px;
      padding: 0.5rem 0;
      cursor: pointer;
    }

    button:hover {
      text-decoration: underline;
    }
    </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <button onclick="history.back()">← Назад</button>

  <h1>Профиль ученика</h1>
  <div class="info" id="student-info">Загрузка...</div>

  <script>
    const name = new URLSearchParams(window.location.search).get("name");
    const userId = Telegram.WebApp.initDataUnsafe?.user?.id;
    const infoDiv = document.getElementById("student-info");

    if (!name || !userId) {
      infoDiv.innerHTML = "Недостаточно данных для отображения.";
    } else {
      fetch('/api/students', {
        headers: { "x-telegram-id": userId }
      })
        .then(res => res.json())
        .then(({ students }) => {
          const student = students.find(s => s.name === name);

          if (!student) {
            infoDiv.innerHTML = "Ученик не найден.";
            return;
          }

          infoDiv.innerHTML = `
            <p><strong>Имя:</strong> ${student.name}</p>
            <p><strong>Язык:</strong> ${student.language || '—'}</p>
            <p><strong>Частота:</strong> ${student.frequency || '—'} раз в неделю</p>
            <p><strong>Следующее занятие:</strong> ${student.next_session || '—'}</p>
          `;
        })
        .catch(err => {
          infoDiv.innerHTML = "Ошибка загрузки данных.";
          console.error(err);
        });
    }
  </script>
</body>
</html>
