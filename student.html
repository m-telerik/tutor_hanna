<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å - Hanna English & French</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/navigation.js"></script>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/student.css">
  <link rel="stylesheet" href="styles/navigation.css">
</head>
<body>
  <div class="container role-student">
    <!-- –•–µ–¥–µ—Ä —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
    <div class="header">
      <button class="back-btn" onclick="history.back()">‚Üê –ù–∞–∑–∞–¥</button>
      <h1><span class="emoji">üéì</span>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
      <div class="header-help">
        <a href="https://t.me/naumenko" target="_blank" class="help-link">
          <span class="emoji">üí¨</span>
          <span class="help-text">–ü–æ–º–æ—â—å</span>
        </a>
      </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <div id="navigation-container"></div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let currentStudent = null;
    let navigation = null;
    let auth = null;
    
    // –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ URL
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('user_id');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞...');
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram WebApp
      if (window.Telegram?.WebApp) {
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
      }
      
      try {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
        auth = new AuthSystem();
        const user = await auth.init(['student', 'admin', 'tutor'], onAuthSuccess, onAuthFail);
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
      }
    });

    // –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    function onAuthSuccess(user) {
      console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', user);
      
      currentStudent = user;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      updatePageHeader(user);
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
      initializeNavigation(user);
    }

    // –ù–µ—É–¥–∞—á–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    function onAuthFail(error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function updatePageHeader(user) {
      const header = document.querySelector('.header h1');
      if (header) {
        header.innerHTML = `<span class="emoji">üéì</span>${user.name || '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å'}`;
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    function initializeNavigation(user) {
      // –°–æ–∑–¥–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞
      navigation = initNavigation(user, 'navigation-container');
      
      // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è —Å–º–µ–Ω—ã —Å–µ–∫—Ü–∏–∏
      document.addEventListener('navigation:sectionChange', handleSectionChange);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø–µ—Ä–≤–æ–π —Å–µ–∫—Ü–∏–∏
      setTimeout(() => {
        const currentSection = navigation.getCurrentSection();
        loadSectionContent(currentSection);
      }, 100);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã —Å–µ–∫—Ü–∏–∏
    function handleSectionChange(event) {
      const { sectionId } = event.detail;
      console.log('üìç –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å–µ–∫—Ü–∏—é:', sectionId);
      
      loadSectionContent(sectionId);
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å–µ–∫—Ü–∏–∏
    async function loadSectionContent(sectionId) {
      console.log('üìö –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —Å–µ–∫—Ü–∏–∏:', sectionId);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
      navigation.setSectionLoading(sectionId, true);
      
      try {
        let content = '';
        
        switch (sectionId) {
          case 'overview':
            content = await loadOverviewContent();
            break;
          case 'lessons':
            content = await loadLessonsContent();
            break;
          case 'vocabulary':
            content = await loadVocabularyContent();
            break;
          case 'progress':
            content = await loadProgressContent();
            break;
          case 'homework':
            content = await loadHomeworkContent();
            break;
          default:
            content = `<div class="empty-state">
              <div class="placeholder-icon">üöß</div>
              <h3>–°–µ–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3>
              <p>–ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Å–µ–∫—Ü–∏–∏ "${sectionId}" –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–∑–∂–µ</p>
            </div>`;
        }
        
        navigation.updateSectionContent(sectionId, content);
        
      } catch (error) {
        console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ–∫—Ü–∏–∏ ${sectionId}:`, error);
        navigation.setSectionError(sectionId, error.message);
      }
    }

    // ===== –ó–ê–ì–†–£–ó–ß–ò–ö–ò –ö–û–ù–¢–ï–ù–¢–ê –°–ï–ö–¶–ò–ô =====

    async function loadOverviewContent() {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—É–¥–µ–Ω—Ç–µ
      const studentInfo = await loadStudentInfo();
      
      return `
        <div class="overview-content">
          <div class="student-profile">
            <div class="profile-header">
              <div class="student-avatar">
                <span class="avatar-emoji">üéì</span>
              </div>
              <div class="student-details">
                <h2>${studentInfo.name}</h2>
                <div class="student-meta">
                  ${studentInfo.email ? `<div class="meta-item">üìß ${studentInfo.email}</div>` : ''}
                  ${studentInfo.username ? `<div class="meta-item">üí¨ @${studentInfo.username}</div>` : ''}
                  <div class="meta-item">üåç ${studentInfo.language || '–Ø–∑—ã–∫ –Ω–µ —É–∫–∞–∑–∞–Ω'}</div>
                </div>
              </div>
            </div>
            
            <div class="profile-stats">
              <div class="stat-item">
                <span class="stat-number">${studentInfo.totalLessons || 0}</span>
                <span class="stat-label">–£—Ä–æ–∫–æ–≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">${studentInfo.vocabularySize || 0}</span>
                <span class="stat-label">–°–ª–æ–≤ –∏–∑—É—á–µ–Ω–æ</span>
              </div>
              <div class="stat-item">
                <span class="stat-number">${studentInfo.studyDays || 0}</span>
                <span class="stat-label">–î–Ω–µ–π –æ–±—É—á–µ–Ω–∏—è</span>
              </div>
            </div>
          </div>
          
          <div class="next-lesson-card">
            ${studentInfo.nextLesson ? `
              <div class="lesson-info">
                <div class="lesson-icon">üìö</div>
                <div class="lesson-details">
                  <h3>–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫</h3>
                  <div class="lesson-time">${studentInfo.nextLesson.datetime}</div>
                  <div class="lesson-meta">
                    ${studentInfo.nextLesson.language} ‚Ä¢ ${studentInfo.nextLesson.duration || 60} –º–∏–Ω
                  </div>
                </div>
                <div class="lesson-actions">
                  ${studentInfo.nextLesson.canJoin ? `
                    <button class="btn-primary" onclick="joinLesson('${studentInfo.nextLesson.zoomLink}')">
                      üé• –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                    </button>
                  ` : `
                    <div class="time-until">${studentInfo.nextLesson.timeUntil}</div>
                  `}
                </div>
              </div>
            ` : `
              <div class="no-lesson">
                <div class="no-lesson-icon">üìÖ</div>
                <h3>–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤</h3>
                <p>–°–≤—è–∂–∏—Ç–µ—Å—å —Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–Ω—è—Ç–∏—è</p>
                <button class="btn-primary" onclick="contactTeacher()">
                  üí¨ –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º
                </button>
              </div>
            `}
          </div>
          
          <div class="quick-actions">
            <button class="action-card" onclick="navigation.switchToSection('lessons')">
              <span class="emoji">üìö</span>
              <div class="title">–ú–æ–∏ —É—Ä–æ–∫–∏</div>
              <div class="subtitle">–ò—Å—Ç–æ—Ä–∏—è –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
            </button>
            <button class="action-card" onclick="navigation.switchToSection('vocabulary')">
              <span class="emoji">üìù</span>
              <div class="title">–°–ª–æ–≤–∞—Ä—å</div>
              <div class="subtitle">${studentInfo.vocabularySize || 0} —Å–ª–æ–≤ –∏–∑—É—á–µ–Ω–æ</div>
            </button>
            <button class="action-card" onclick="navigation.switchToSection('progress')">
              <span class="emoji">üìà</span>
              <div class="title">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
              <div class="subtitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è</div>
            </button>
          </div>
        </div>
      `;
    }

    async function loadLessonsContent() {
      const lessonsResponse = await auth.apiRequest(`/api/student-lessons?user_id=${userId || currentStudent.id}`);
      const { lessons, stats } = await lessonsResponse.json();
      
      return `
        <div class="lessons-content">
          <div class="section-header">
            <h3>–ú–æ–∏ —É—Ä–æ–∫–∏</h3>
            <div class="lesson-filters">
              <select id="lessonFilter" onchange="filterLessons()">
                <option value="all">–í—Å–µ —É—Ä–æ–∫–∏</option>
                <option value="upcoming">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ</option>
                <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
                <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ</option>
              </select>
            </div>
          </div>
          
          <div class="lessons-stats">
            <div class="stat-item">
              <span class="stat-number">${stats.upcoming}</span>
              <span class="stat-label">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${stats.completed}</span>
              <span class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${stats.total}</span>
              <span class="stat-label">–í—Å–µ–≥–æ</span>
            </div>
          </div>
          
          <div class="lessons-list" id="lessons-list">
            ${lessons.length === 0 ? `
              <div class="empty-state">
                <div class="placeholder-icon">üìö</div>
                <h3>–ù–µ—Ç —É—Ä–æ–∫–æ–≤</h3>
                <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∏ –∑–∞–Ω—è—Ç–∏—è</p>
              </div>
            ` : `
              ${lessons.map(lesson => `
                <div class="lesson-item ${lesson.status}">
                  <div class="lesson-date">
                    <div class="date">${lesson.formatted_date}</div>
                    <div class="time">${lesson.formatted_time}</div>
                    <div class="weekday">${lesson.weekday_short}</div>
                  </div>
                  <div class="lesson-info">
                    <div class="lesson-title">
                      ${lesson.display_type} ‚Ä¢ ${lesson.display_language}
                    </div>
                    <div class="lesson-status">
                      <span class="status-badge ${lesson.status}">${lesson.status_emoji} ${lesson.display_status}</span>
                    </div>
                    ${lesson.notes ? `<div class="lesson-notes">${lesson.notes}</div>` : ''}
                  </div>
                  <div class="lesson-actions">
                    ${lesson.can_join ? `
                      <button class="action-btn primary" onclick="joinLesson('${lesson.zoom_link}')">
                        üé• –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                      </button>
                    ` : lesson.is_upcoming ? `
                      <div class="time-until">${lesson.time_until}</div>
                    ` : ''}
                    ${lesson.is_past ? `
                      <button class="action-btn secondary" onclick="viewLessonVocab('${lesson.id}')">
                        üìù –°–ª–æ–≤–∞—Ä—å
                      </button>
                    ` : ''}
                  </div>
                </div>
              `).join('')}
            `}
          </div>
        </div>
      `;
    }

    async function loadVocabularyContent() {
      const vocabResponse = await auth.apiRequest(`/api/vocab?user_id=${userId || currentStudent.id}`);
      const { words } = await vocabResponse.json();
      
      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —è–∑—ã–∫–∞–º
      const englishWords = words.filter(w => w.language === 'english');
      const frenchWords = words.filter(w => w.language === 'french');
      const studiedWords = words.filter(w => w.studied_count > 0);
      
      return `
        <div class="vocabulary-content">
          <div class="section-header">
            <h3>–ú–æ–π —Å–ª–æ–≤–∞—Ä—å</h3>
            <div class="vocab-actions">
              <button class="btn-secondary" onclick="openFullVocabulary()">
                üìö –ü–æ–ª–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å
              </button>
            </div>
          </div>
          
          <div class="vocab-stats">
            <div class="stat-item">
              <span class="stat-number">${words.length}</span>
              <span class="stat-label">–í—Å–µ–≥–æ —Å–ª–æ–≤</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${englishWords.length}</span>
              <span class="stat-label">English</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${frenchWords.length}</span>
              <span class="stat-label">French</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">${studiedWords.length}</span>
              <span class="stat-label">–ò–∑—É—á–µ–Ω–æ</span>
            </div>
          </div>
          
          <div class="vocab-sections">
            <div class="vocab-section">
              <h4>üÜï –ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ</h4>
              <div class="words-list">
                ${words.slice(0, 10).map(word => `
                  <div class="word-item ${word.studied_count > 0 ? 'studied' : ''}">
                    <div class="word-main">
                      <div class="word-text">${word.word}</div>
                      <div class="word-translation">${word.translation || ''}</div>
                    </div>
                    <div class="word-meta">
                      ${word.language ? `<span class="language-badge ${word.language}">${word.language}</span>` : ''}
                      ${word.studied_count > 0 ? `<span class="studied-badge">‚úì ${word.studied_count}</span>` : ''}
                    </div>
                    <button class="word-action" onclick="practiceWord('${word.id}')">
                      ${word.studied_count > 0 ? 'üîÑ' : 'üìñ'}
                    </button>
                  </div>
                `).join('')}
              </div>
            </div>
            
            ${words.filter(w => w.studied_count === 0).length > 0 ? `
              <div class="vocab-section">
                <h4>üìö –î–ª—è –∏–∑—É—á–µ–Ω–∏—è</h4>
                <div class="words-list">
                  ${words.filter(w => w.studied_count === 0).slice(0, 5).map(word => `
                    <div class="word-item">
                      <div class="word-main">
                        <div class="word-text">${word.word}</div>
                        <div class="word-translation">${word.translation || ''}</div>
                      </div>
                      <div class="word-meta">
                        ${word.language ? `<span class="language-badge ${word.language}">${word.language}</span>` : ''}
                      </div>
                      <button class="word-action" onclick="practiceWord('${word.id}')">üìñ</button>
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    async function loadProgressContent() {
      const progressData = await loadProgressData();
      
      return `
        <div class="progress-content">
          <div class="section-header">
            <h3>–ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
            <div class="progress-period">
              <select id="progressPeriod" onchange="updateProgressPeriod()">
                <option value="week">–ù–µ–¥–µ–ª—è</option>
                <option value="month">–ú–µ—Å—è—Ü</option>
                <option value="all">–í—Å–µ –≤—Ä–µ–º—è</option>
              </select>
            </div>
          </div>
          
          <div class="progress-overview">
            <div class="progress-card">
              <div class="progress-icon">üìà</div>
              <div class="progress-info">
                <h4>–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h4>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: ${progressData.overall}%"></div>
                </div>
                <div class="progress-text">${progressData.overall}% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
              </div>
            </div>
          </div>
          
          <div class="progress-details">
            <div class="detail-card">
              <h4>üìö –û–±—É—á–µ–Ω–∏–µ</h4>
              <div class="detail-stats">
                <div class="detail-item">
                  <span class="detail-label">–£—Ä–æ–∫–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ:</span>
                  <span class="detail-value">${progressData.lessonsCompleted}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">–ß–∞—Å–æ–≤ –æ–±—É—á–µ–Ω–∏—è:</span>
                  <span class="detail-value">${progressData.studyHours}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞:</span>
                  <span class="detail-value">${progressData.averageGrade}/5</span>
                </div>
              </div>
            </div>
            
            <div class="detail-card">
              <h4>üìù –°–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å</h4>
              <div class="detail-stats">
                <div class="detail-item">
                  <span class="detail-label">–ù–æ–≤—ã—Ö —Å–ª–æ–≤:</span>
                  <span class="detail-value">${progressData.newWords}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π:</span>
                  <span class="detail-value">${progressData.wordReviews}</span>
                </div>
                <div class="detail-item">
                  <span class="detail-label">–û—Å–≤–æ–µ–Ω–æ:</span>
                  <span class="detail-value">${progressData.masteredWords}</span>
                </div>
              </div>
            </div>
            
            <div class="detail-card">
              <h4>üéØ –¶–µ–ª–∏</h4>
              <div class="goals-list">
                ${progressData.goals.map(goal => `
                  <div class="goal-item">
                    <div class="goal-info">
                      <span class="goal-title">${goal.title}</span>
                      <div class="goal-progress">
                        <div class="goal-bar">
                          <div class="goal-fill" style="width: ${goal.progress}%"></div>
                        </div>
                        <span class="goal-percent">${goal.progress}%</span>
                      </div>
                    </div>
                    <span class="goal-emoji">${goal.emoji}</span>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    async function loadHomeworkContent() {
      return `
        <div class="homework-content">
          <div class="section-header">
            <h3>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</h3>
            <div class="homework-filters">
              <select id="homeworkFilter">
                <option value="all">–í—Å–µ –∑–∞–¥–∞–Ω–∏—è</option>
                <option value="pending">–ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</option>
                <option value="completed">–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</option>
                <option value="overdue">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ</option>
              </select>
            </div>
          </div>
          
          <div class="homework-stats">
            <div class="stat-item">
              <span class="stat-number">3</span>
              <span class="stat-label">–ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">12</span>
              <span class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">1</span>
              <span class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
            </div>
          </div>
          
          <div class="homework-list">
            <div class="homework-item pending">
              <div class="homework-icon">üìù</div>
              <div class="homework-info">
                <h4>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è Past Simple</h4>
                <div class="homework-meta">
                  <span class="due-date">–°—Ä–æ–∫: 15 –∞–≤–≥—É—Å—Ç–∞</span>
                  <span class="subject">English Grammar</span>
                </div>
                <div class="homework-description">
                  –í—ã–ø–æ–ª–Ω–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è 1-5 –Ω–∞ —Å—Ç—Ä. 42-44
                </div>
              </div>
              <div class="homework-actions">
                <button class="action-btn primary">üìñ –û—Ç–∫—Ä—ã—Ç—å</button>
              </div>
            </div>
            
            <div class="homework-item pending">
              <div class="homework-icon">üéß</div>
              <div class="homework-info">
                <h4>–ê—É–¥–∏—Ä–æ–≤–∞–Ω–∏–µ: –î–∏–∞–ª–æ–≥–∏</h4>
                <div class="homework-meta">
                  <span class="due-date">–°—Ä–æ–∫: 16 –∞–≤–≥—É—Å—Ç–∞</span>
                  <span class="subject">English Listening</span>
                </div>
                <div class="homework-description">
                  –ü—Ä–æ—Å–ª—É—à–∞—Ç—å 3 –¥–∏–∞–ª–æ–≥–∞ –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
                </div>
              </div>
              <div class="homework-actions">
                <button class="action-btn primary">üéß –°–ª—É—à–∞—Ç—å</button>
              </div>
            </div>
            
            <div class="homework-item completed">
              <div class="homework-icon">‚úÖ</div>
              <div class="homework-info">
                <h4>–ß—Ç–µ–Ω–∏–µ: –ö–æ—Ä–æ—Ç–∫–∏–π —Ä–∞—Å—Å–∫–∞–∑</h4>
                <div class="homework-meta">
                  <span class="due-date">–í—ã–ø–æ–ª–Ω–µ–Ω–æ 12 –∞–≤–≥—É—Å—Ç–∞</span>
                  <span class="subject">English Reading</span>
                </div>
                <div class="homework-description">
                  –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Å–∫–∞–∑ –∏ –Ω–∞–ø–∏—Å–∞—Ç—å –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
                </div>
              </div>
              <div class="homework-actions">
                <button class="action-btn secondary">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====

    async function loadStudentInfo() {
      try {
        const response = await auth.apiRequest('/api/students');
        const { students } = await response.json();
        
        // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
        const student = students.find(s => s.id === (userId || currentStudent.id)) || students[0];
        
        return {
          name: student.name,
          email: student.email,
          username: student.username,
          language: student.language,
          totalLessons: 15, // –º–æ–∫ –¥–∞–Ω–Ω—ã–µ
          vocabularySize: student.vocabulary_size || 127,
          studyDays: 45,
          nextLesson: student.next_session ? {
            datetime: student.next_session,
            language: student.session_language || student.language,
            duration: student.duration || 60,
            canJoin: student.can_join,
            zoomLink: student.zoom_link,
            timeUntil: student.time_until
          } : null
        };
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞:', error);
        return {
          name: currentStudent?.name || '–°—Ç—É–¥–µ–Ω—Ç',
          totalLessons: 0,
          vocabularySize: 0,
          studyDays: 0,
          nextLesson: null
        };
      }
    }

    async function loadProgressData() {
      return {
        overall: 67,
        lessonsCompleted: 15,
        studyHours: 23,
        averageGrade: 4.2,
        newWords: 45,
        wordReviews: 127,
        masteredWords: 89,
        goals: [
          { title: '–í—ã—É—á–∏—Ç—å 100 –Ω–æ–≤—ã—Ö —Å–ª–æ–≤', progress: 67, emoji: 'üìö' },
          { title: '–ü—Ä–æ–π—Ç–∏ 20 —É—Ä–æ–∫–æ–≤', progress: 75, emoji: 'üéØ' },
          { title: '–ò–∑—É—á–∏—Ç—å Past Perfect', progress: 40, emoji: 'üìñ' }
        ]
      };
    }

    // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–ï–ô–°–¢–í–ò–ô =====

    function joinLesson(zoomLink) {
      if (zoomLink) {
        window.open(zoomLink, '_blank');
      } else {
        showNotification('–°—Å—ã–ª–∫–∞ –Ω–∞ —É—Ä–æ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'warning');
      }
    }

    function contactTeacher() {
      // –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç —Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã
      showNotification('üîß –§—É–Ω–∫—Ü–∏—è —Å–≤—è–∑–∏ —Å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    }

    function filterLessons() {
      const filter = document.getElementById('lessonFilter').value;
      showNotification(`üîß –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É—Ä–æ–∫–æ–≤: ${filter}`, 'info');
    }

    function viewLessonVocab(lessonId) {
      window.location.href = `lesson.html?session_id=${lessonId}`;
    }

    function openFullVocabulary() {
      window.location.href = `vocabulary.html?user_id=${userId || currentStudent.id}`;
    }

    function practiceWord(wordId) {
      showNotification(`üîß –ü—Ä–∞–∫—Ç–∏–∫–∞ —Å–ª–æ–≤–∞ ${wordId} –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
    }

    function updateProgressPeriod() {
      const period = document.getElementById('progressPeriod').value;
      showNotification(`üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞ ${period}`, 'info');
    }

    // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Ç–∞ –∂–µ —Ñ—É–Ω–∫—Ü–∏—è —á—Ç–æ –∏ –¥–ª—è —Ç—å—é—Ç–æ—Ä–∞)
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'var(--success-color)' :
                     type === 'error' ? 'var(--error-color)' :
                     type === 'warning' ? '#ff9800' : 'var(--accent-color)'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        max-width: 300px;
        font-size: 13px;
        animation: slideInRight 0.3s ease-out;
        line-height: 1.4;
      `;

      if (!document.getElementById('notificationStyles')) {
        const style = document.createElement('style');
        style.id = 'notificationStyles';
        style.textContent = `
          @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
        `;
        document.head.appendChild(style);
      }

      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        if (document.body.contains(notification)) {
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => {
            if (document.body.contains(notification)) {
              document.body.removeChild(notification);
            }
          }, 300);
        }
      }, 3000);
    }

    console.log('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
  </script>
</body>
</html>