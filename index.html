<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hanna English & French</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="js/auth.js"></script>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="container">
    <div id="loadingScreen">
      <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; text-align: center;">
        <div style="width: 50px; height: 50px; border: 3px solid var(--accent-color); border-top: 3px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 2rem;"></div>
        <h1 style="color: var(--accent-color); margin-bottom: 1rem;">Hanna English & French</h1>
        <p style="opacity: 0.8; margin-bottom: 2rem;">–û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞—à—É —Ä–æ–ª—å...</p>
      </div>
    </div>
  </div>

  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...');
      
      try {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π
        const auth = new AuthSystem();
        const user = await auth.init(['admin', 'student', 'tutor'], onAuthSuccess, onAuthFail);
        
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
        // –û—à–∏–±–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ AuthSystem
      }
    });

    // –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –ø–æ —Ä–æ–ª–∏
    function onAuthSuccess(user) {
      console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', user);
      
      // –†–æ—É—Ç–∏–Ω–≥ –ø–æ —Ä–æ–ª—è–º
      switch (user.role) {
        case 'admin':
          window.location.href = 'admin.html';
          break;
        case 'student':
          // –î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö –ø—Ä–æ—Ñ–∏–ª—å
          if (user.name) {
            window.location.href = `student.html?name=${encodeURIComponent(user.name)}`;
          } else {
            window.location.href = 'booking.html'; // Fallback –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
          }
          break;
        case 'tutor':
          window.location.href = 'tutor.html';
          break;
        case 'prospect':
          // –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏–¥—É—Ç –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
          window.location.href = 'booking.html';
          break;
        default:
          console.warn('ü§î –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å:', user.role);
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—ã–±–æ—Ä–∞ —Ä–æ–ª–∏ –∏–ª–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
          window.location.href = 'booking.html';
      }
    }

    // –ù–µ—É–¥–∞—á–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    function onAuthFail(error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
      // AuthSystem —Å–∞–º –ø–æ–∫–∞–∂–µ—Ç —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏
    }

    console.log('‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
  </script>
</body>
</html>
