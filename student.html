<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Профиль ученика</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; background: #f9f9f9; }
    .info { font-size: 1.1rem; background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.05); }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <button onclick="history.back()">← Назад</button>

  <h1>Профиль ученика</h1>
  <div class="info" id="student-info">Загрузка...</div>

  <script>
    const name = new URLSearchParams(window.location.search).get("name");
    const userId = Telegram.WebApp.initDataUnsafe?.user?.id;
    const infoDiv = document.getElementById("student-info");

    if (!name || !userId) {
      infoDiv.innerHTML = "Недостаточно данных для отображения.";
    } else {
      fetch('/api/students', {
        headers: { "x-telegram-id": userId }
      })
        .then(res => res.json())
        .then(({ students }) => {
          const student = students.find(s => s.name === name);

          if (!student) {
            infoDiv.innerHTML = "Ученик не найден.";
            return;
          }

          infoDiv.innerHTML = `
            <p><strong>Имя:</strong> ${student.name}</p>
            <p><strong>Язык:</strong> ${student.language || '—'}</p>
            <p><strong>Частота:</strong> ${student.frequency || '—'} раз в неделю</p>
            <p><strong>Следующее занятие:</strong> ${student.next_session || '—'}</p>
          `;
        })
        .catch(err => {
          infoDiv.innerHTML = "Ошибка загрузки данных.";
          console.error(err);
        });
    }
  </script>
</body>
</html>
