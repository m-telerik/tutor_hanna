<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω—è—Ç–∏–µ</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="js/auth.js"></script>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/booking.css">
</head>
<body>
  <div id="bookingContent" style="display: none;">
    <div class="header">
      <button onclick="history.back()">‚Üê –ù–∞–∑–∞–¥</button>
      <h1><span class="emoji">üìÖ</span>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
      <div></div>
    </div>

    <div class="welcome-info" id="welcomeInfo" style="display: none;">
      <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    </div>

    <div class="quick-actions">
      <a href="https://t.me/hanna_teaches" class="action-btn">
        <span class="emoji">üí¨</span>
        <strong>–ù–∞–ø–∏—Å–∞—Ç—å –•–∞–Ω–Ω–µ</strong>
        <small>–û–±—Å—É–¥–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</small>
      </a>
      
      <div class="action-btn" onclick="openCalendarBooking()">
        <span class="emoji">üìÖ</span>
        <strong>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è</strong>
        <small>–í—ã–±—Ä–∞—Ç—å —Å–ª–æ—Ç –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ</small>
      </div>
    </div>

    <div class="calendar-container">
      <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 400px; background: var(--card-bg); border-radius: 8px; padding: 2rem; text-align: center;">
        <div style="width: 50px; height: 50px; border: 3px solid var(--accent-color); border-top: 3px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 2rem;"></div>
        <h2 style="margin-bottom: 1rem; color: var(--accent-color);">–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å...</h2>
        <p style="opacity: 0.8; margin-bottom: 2rem; line-height: 1.6; max-width: 300px;">
          –°–µ–π—á–∞—Å –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –•–∞–Ω–Ω—ã
        </p>
        <button onclick="openCalendarBooking()" class="external-link-btn" style="font-size: 16px; padding: 12px 24px;">
          <span class="emoji">üìÖ</span>–û—Ç–∫—Ä—ã—Ç—å –≤—Ä—É—á–Ω—É—é
        </button>
        <p style="font-size: 12px; opacity: 0.6; margin-top: 1rem;">
          –ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
        </p>
      </div>
    </div>
  </div>

  <script>
    const CALENDAR_BOOKING_URL = 'https://calendar.app.google/SQGJj626MUyQ6DYL6';
    let auth = null;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è...');
      
      try {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é - –¥–æ—Å—Ç—É–ø –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
        auth = new AuthSystem();
        const user = await auth.init(['admin', 'student'], onAuthSuccess, onAuthFail);
        
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
        // –î–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        showBookingForProspects();
      }
    });

    // –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    function onAuthSuccess(user) {
      console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', user);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
      document.getElementById('bookingContent').style.display = 'block';
      
      // –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
      const welcomeInfo = document.getElementById('welcomeInfo');
      welcomeInfo.innerHTML = `
        <div style="background: var(--card-bg); border-radius: 12px; padding: 1.5rem; margin: 1rem 0; border: 1px solid var(--border-color); text-align: center;">
          <h2 style="margin: 0 0 0.5rem 0; color: var(--accent-color);">
            üëã –ü—Ä–∏–≤–µ—Ç, ${user.first_name || user.name || '—Å—Ç—É–¥–µ–Ω—Ç'}!
          </h2>
          <p style="margin: 0; opacity: 0.8;">
            ${user.role === 'admin' ? '–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω—è—Ç–∏–µ –¥–ª—è –ª—é–±–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞' : '–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∑–∞–Ω—è—Ç–∏—è'}
          </p>
          ${user.next_session ? `
            <div style="margin-top: 1rem; padding: 0.8rem; background: var(--success-color); color: white; border-radius: 8px;">
              üìÖ –í–∞—à–µ —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–Ω—è—Ç–∏–µ: ${user.next_session.date}
            </div>
          ` : ''}
        </div>
      `;
      welcomeInfo.style.display = 'block';
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
      setTimeout(() => {
        if (window.Telegram?.WebApp?.openLink) {
          window.Telegram.WebApp.openLink(CALENDAR_BOOKING_URL);
        } else {
          window.location.href = CALENDAR_BOOKING_URL;
        }
      }, 1000);
    }

    // –ù–µ—É–¥–∞—á–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏–ª–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã
    function onAuthFail(error) {
      console.log('‚ÑπÔ∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤');
      showBookingForProspects();
    }

    <script>
  // –ù–µ—É–¥–∞—á–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
  function onAuthFail(error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);

    // –ï—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤—ã–π –∏–ª–∏ –Ω–µ–æ–ø–æ–∑–Ω–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    if (error?.message?.includes('–Ω–µ –Ω–∞–π–¥–µ–Ω') || error?.message?.includes('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω')) {
      window.location.href = 'booking.html';
      return;
    }

    // –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π: –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –±–µ–∑ —Ä–æ–ª–∏ ‚Äî —Ç–æ–∂–µ —Ç—É–¥–∞
    window.location.href = 'booking.html';
  }
</script>

    // –ü–æ–∫–∞–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
    function showBookingForProspects() {
      document.getElementById('bookingContent').style.display = 'block';
      
      const welcomeInfo = document.getElementById('welcomeInfo');
      welcomeInfo.innerHTML = `
        <div style="background: linear-gradient(135deg, var(--accent-color) 0%, #5856d6 100%); color: white; border-radius: 12px; padding: 2rem; margin: 1rem 0; text-align: center;">
          <h2 style="margin: 0 0 1rem 0;">üåü –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
          <p style="margin: 0 0 1rem 0; opacity: 0.9; line-height: 1.5;">
            –ì–æ—Ç–æ–≤—ã –∏–∑—É—á–∞—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏–ª–∏ —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π —è–∑—ã–∫ —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º?
          </p>
          <p style="margin: 0; font-size: 14px; opacity: 0.8;">
            –ó–∞–±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤–æ–µ –∑–∞–Ω—è—Ç–∏–µ –∏ –Ω–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π –ø—É—Ç—å –∫ —Å–≤–æ–±–æ–¥–Ω–æ–º—É –≤–ª–∞–¥–µ–Ω–∏—é —è–∑—ã–∫–æ–º!
          </p>
        </div>
      `;
      welcomeInfo.style.display = 'block';
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram WebApp
      if (window.Telegram?.WebApp) {
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
      }
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
      setTimeout(() => {
        if (window.Telegram?.WebApp?.openLink) {
          window.Telegram.WebApp.openLink(CALENDAR_BOOKING_URL);
        } else {
          window.location.href = CALENDAR_BOOKING_URL;
        }
      }, 1000);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    function openCalendarBooking() {
      if (window.Telegram?.WebApp?.openLink) {
        window.Telegram.WebApp.openLink(CALENDAR_BOOKING_URL);
      } else {
        window.location.href = CALENDAR_BOOKING_URL;
      }
    }

    console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
  </script>
  
  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</body>
</html>
