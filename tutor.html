<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ü–∞–Ω–µ–ª—å —Ç—å—é—Ç–æ—Ä–∞ - Hanna English & French</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/tutor.css">
</head>
<body>
  <div class="container">
    <!-- –ü–∞–Ω–µ–ª—å —Ç—å—é—Ç–æ—Ä–∞ -->
    <div id="tutorPanel">
      <div class="tutor-header">
        <h1><span class="emoji">üë©‚Äçüè´</span>–ü–∞–Ω–µ–ª—å —Ç—å—é—Ç–æ—Ä–∞</h1>
        <div class="tutor-info" id="tutorInfo">
          –ó–∞–≥—Ä—É–∑–∫–∞...
        </div>
      </div>
      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—å—é—Ç–æ—Ä–∞ -->
  <div class="stats-grid" id="statsGrid">
    <div class="stat-card">
      <div class="stat-number" id="myStudents">0</div>
      <div class="stat-label">–ú–æ–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="todayLessons">0</div>
      <div class="stat-label">–°–µ–≥–æ–¥–Ω—è —É—Ä–æ–∫–æ–≤</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="weekLessons">0</div>
      <div class="stat-label">–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="recurringSchedules">0</div>
      <div class="stat-label">–†–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π</div>
    </div>
  </div>

  <!-- –ù–û–í–´–ô –†–ê–ó–î–ï–õ: –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è -->
  <div class="recurring-section">
    <div class="section-header">
      <h2 class="section-title">
        <span class="emoji">üîÑ</span>–†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
      </h2>
      <div class="recurring-actions">
        <button class="create-btn" onclick="createRecurringSchedule()">
          <span class="emoji">‚ûï</span>–°–æ–∑–¥–∞—Ç—å
        </button>
        <button class="refresh-btn" onclick="loadRecurringSchedules()">
          <span class="emoji">üîÑ</span>–û–±–Ω–æ–≤–∏—Ç—å
        </button>
      </div>
    </div>
    
    <div id="recurringContent">
      <div class="loading">
        <span class="loading-spinner"></span>
        –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π...
      </div>
    </div>
  </div>

  <!-- –ë–ª–∏–∂–∞–π—à–∏–µ —É—Ä–æ–∫–∏ -->
  <div class="lessons-section">
    <div class="section-header">
      <h2 class="section-title">
        <span class="emoji">üìö</span>–ë–ª–∏–∂–∞–π—à–∏–µ —É—Ä–æ–∫–∏
      </h2>
      <div class="lessons-filter">
        <select id="lessonsFilter" onchange="filterLessons()">
          <option value="today">–°–µ–≥–æ–¥–Ω—è</option>
          <option value="tomorrow">–ó–∞–≤—Ç—Ä–∞</option>
          <option value="week">–≠—Ç–∞ –Ω–µ–¥–µ–ª—è</option>
          <option value="all">–í—Å–µ</option>
        </select>
      </div>
    </div>
    
    <div id="lessonsContent">
      <div class="loading">
        <span class="loading-spinner"></span>
        –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–æ–≤...
      </div>
    </div>
  </div>

  <!-- –ú–æ–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã -->
  <div class="students-section">
    <div class="section-header">
      <h2 class="section-title">
        <span class="emoji">üßë‚Äçüéì</span>–ú–æ–∏ —Å—Ç—É–¥–µ–Ω—Ç—ã
      </h2>
      <button class="refresh-btn" onclick="loadMyStudents()">
        <span class="emoji">üîÑ</span>–û–±–Ω–æ–≤–∏—Ç—å
      </button>
    </div>
    
    <div class="table-container">
      <div id="studentsContent">
        <div class="loading">
          <span class="loading-spinner"></span>
          –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...
        </div>
      </div>
    </div>
  </div>
</div>
</div>
  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ç—å—é—Ç–æ—Ä–∞
    const TUTOR_CONFIG = {
      tutorId: 'hanna_teaches', // ID —Ç—å—é—Ç–æ—Ä–∞
      tutorName: '–ê–Ω–Ω–∞',
      tutorLanguages: ['English', 'French'],
      hourlyRate: 2000 // —Ä—É–±/—á–∞—Å
    };
    
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let currentTutor = null;
    let studentsData = [];
    let lessonsData = [];
    let recurringData = [];
    let isAuthenticated = false;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–Ω–µ–ª–∏ —Ç—å—é—Ç–æ—Ä–∞...');
      
      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram WebApp (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
      if (window.Telegram?.WebApp) {
        console.log('üì± Telegram WebApp –æ–±–Ω–∞—Ä—É–∂–µ–Ω');
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
      }
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç—å—é—Ç–æ—Ä–∞
      currentTutor = {
        id: TUTOR_CONFIG.tutorId,
        name: TUTOR_CONFIG.tutorName,
        languages: TUTOR_CONFIG.tutorLanguages,
        rate: TUTOR_CONFIG.hourlyRate,
        sessionTime: Date.now()
      };
      
      showTutorPanel();
      loadInitialData();
    });

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ —Ç—å—é—Ç–æ—Ä–∞
    function showTutorPanel() {
      console.log('‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Ç—å—é—Ç–æ—Ä–∞');
      
      const tutorPanel = document.getElementById('tutorPanel');
      if (tutorPanel) {
        tutorPanel.style.display = 'block';
      }
      
      isAuthenticated = true;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—å—é—Ç–æ—Ä–µ
      const tutorInfo = document.getElementById('tutorInfo');
      if (tutorInfo) {
        tutorInfo.innerHTML = `
          ${currentTutor.name} ‚Ä¢ ${currentTutor.languages.join(' & ')}
          <small style="display: block; opacity: 0.9;">
            –°—Ç–∞–≤–∫–∞: ${currentTutor.rate}‚ÇΩ/—á–∞—Å
          </small>
        `;
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    async function loadInitialData() {
      console.log('üìä –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ç—å—é—Ç–æ—Ä–∞...');
      
      setTimeout(async () => {
        await loadMyStudents();
        await loadRecurringSchedules();
        await loadUpcomingLessons();
      }, 100);
    }

    // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
    async function loadRecurringSchedules() {
      console.log('üìÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π...');
      const recurringContent = document.getElementById('recurringContent');
      
      if (!recurringContent) {
        console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç recurringContent –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      recurringContent.innerHTML = `
        <div class="loading">
          <span class="loading-spinner"></span>
          –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π...
        </div>
      `;

      try {
        // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π fetch –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const response = await fetch('/api/recurring-schedules', {
          headers: { 'x-telegram-id': '618647337' } // ID –•–∞–Ω–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('‚úÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', data.schedules?.length || 0);
        
        if (!data.schedules) {
          throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç API: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ schedules');
        }
        
        recurringData = data.schedules;
        renderRecurringSchedules(recurringData);
        updateTutorStats();
        
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π:', error);
        recurringContent.innerHTML = `
          <div class="error">
            <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
            <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è: ${error.message}</p>
            <button onclick="loadRecurringSchedules()" class="btn-primary">
              –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
          </div>
        `;
      }
    }

    // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π
    function renderRecurringSchedules(schedules) {
      const recurringContent = document.getElementById('recurringContent');
      
      if (schedules.length === 0) {
        recurringContent.innerHTML = `
          <div class="empty-state">
            <span class="emoji" style="font-size: 3em;">üìÖ</span>
            <p>–ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π</p>
            <button onclick="createRecurringSchedule()" class="btn-primary">
              <span class="emoji">‚ûï</span>–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            </button>
          </div>
        `;
        return;
      }

      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
      const schedulesByDay = groupSchedulesByDay(schedules);
      
      recurringContent.innerHTML = `
        <div class="recurring-grid">
          ${Object.entries(schedulesByDay).map(([day, daySchedules]) => `
            <div class="day-column">
              <h3 class="day-header">${getDayName(day)}</h3>
              <div class="day-schedules">
                ${daySchedules.map(schedule => renderScheduleCard(schedule)).join('')}
              </div>
            </div>
          `).join('')}
        </div>
        
        <div class="recurring-stats">
          <div class="stat-item">
            <span class="stat-number">${schedules.length}</span>
            <span class="stat-label">–í—Å–µ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">${schedules.filter(s => s.type === 'individual').length}</span>
            <span class="stat-label">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">${schedules.filter(s => s.type === 'pair').length}</span>
            <span class="stat-label">–ü–∞—Ä–Ω—ã—Ö</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">${schedules.filter(s => !s.is_active).length}</span>
            <span class="stat-label">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö</span>
          </div>
        </div>
      `;
    }

    // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
    function renderRecurringSchedules(schedules) {
  const recurringContent = document.getElementById('recurringContent');

  if (!schedules.length) {
    recurringContent.innerHTML = `
      <div class="empty-state">
        <span class="emoji" style="font-size: 3em;">üìÖ</span>
        <p>–ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π</p>
        <button onclick="createRecurringSchedule()" class="btn-primary">
          <span class="emoji">‚ûï</span>–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        </button>
      </div>
    `;
    return;
  }

  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–Ω—è–º
  const schedulesByDay = groupSchedulesByDay(schedules);
  const daysOrder = [1, 2, 3, 4, 5, 6, 7];

  // –¢–∞–±—ã
  const tabsHtml = daysOrder.map(day => `
    <button class="day-tab" data-day="${day}">
      ${getDayName(day)}
    </button>
  `).join('');

  // –ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ –¥–Ω—è–º
  const contentHtml = daysOrder.map(day => {
    const daySchedules = schedulesByDay[day] || [];
    return `
      <div class="day-schedule" data-day="${day}" style="display:none;">
        ${daySchedules.map(s => renderCompactScheduleCard(s)).join('')}
      </div>
    `;
  }).join('');

  recurringContent.innerHTML = `
    <div class="day-tabs">${tabsHtml}</div>
    ${contentHtml}
  `;

  // –ù–∞–≤–µ—à–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Ç–∞–±—ã
  const tabs = recurringContent.querySelectorAll('.day-tab');
  const dayBlocks = recurringContent.querySelectorAll('.day-schedule');
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const day = tab.dataset.day;
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      dayBlocks.forEach(block => {
        block.style.display = block.dataset.day === day ? 'block' : 'none';
      });
    });
  });

  // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π —Ç–∞–± —Å –∑–∞–Ω—è—Ç–∏—è–º–∏ (–∏–ª–∏ —Å–µ–≥–æ–¥–Ω—è)
  const today = new Date().getDay() || 7;
  const firstDayWithLessons = daysOrder.find(d => (schedulesByDay[d] || []).length > 0) || today;
  const firstTab = recurringContent.querySelector(`.day-tab[data-day="${firstDayWithLessons}"]`);
  if (firstTab) firstTab.click();
}

function renderCompactScheduleCard(schedule) {
  const participants = schedule.participant_names?.join(', ') || '‚Äî';
  const nextSession = schedule.next_session_datetime ?
    new Date(schedule.next_session_datetime).toLocaleDateString('ru-RU') : '–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ';

  return `
    <div class="schedule-card ${schedule.is_active ? 'active' : 'inactive'}">
      <div class="time-badge">${schedule.time_start}</div>
      <div class="schedule-info">
        <h4>${schedule.name}</h4>
        <div class="meta">
          <span class="type-badge ${schedule.type}">${getTypeLabel(schedule.type)}</span>
          ${schedule.language ? `<span class="language-badge">${schedule.language}</span>` : ''}
        </div>
        <div class="participants">üë• ${participants}</div>
        <div class="next-session">üìÖ ${nextSession}</div>
        ${schedule.zoom_link ? `<a href="${schedule.zoom_link}" target="_blank" class="zoom-link">üîó Zoom</a>` : ''}
      </div>
      <div class="actions">
        <button class="action-btn primary" onclick="editRecurringSchedule('${schedule.id}')">‚úèÔ∏è</button>
        <button class="action-btn secondary" onclick="toggleScheduleStatus('${schedule.id}', ${!schedule.is_active})">
          ${schedule.is_active ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
        </button>
        <button class="action-btn secondary" onclick="viewScheduleSessions('${schedule.id}')">üìÖ</button>
        <button class="action-btn danger" onclick="deleteRecurringSchedule('${schedule.id}')">üóëÔ∏è</button>
      </div>
    </div>
  `;
}

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function groupSchedulesByDay(schedules) {
      const grouped = {};
      schedules.forEach(schedule => {
        const day = schedule.day_of_week;
        if (!grouped[day]) grouped[day] = [];
        grouped[day].push(schedule);
      });
      
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è
      Object.keys(grouped).forEach(day => {
        grouped[day].sort((a, b) => a.time_start.localeCompare(b.time_start));
      });
      
      return grouped;
    }

    function getDayName(dayNumber) {
      const days = {
        1: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',
        2: '–í—Ç–æ—Ä–Ω–∏–∫', 
        3: '–°—Ä–µ–¥–∞',
        4: '–ß–µ—Ç–≤–µ—Ä–≥',
        5: '–ü—è—Ç–Ω–∏—Ü–∞',
        6: '–°—É–±–±–æ—Ç–∞',
        7: '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'
      };
      return days[dayNumber] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
    }

    function getTypeLabel(type) {
      const types = {
        'individual': '–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π',
        'pair': '–ü–∞—Ä–Ω—ã–π', 
        'group': '–ì—Ä—É–ø–ø–æ–≤–æ–π'
      };
      return types[type] || type;
    }

    // –î–µ–π—Å—Ç–≤–∏—è —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏
    function createRecurringSchedule() {
      showNotification('üîß –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    }

    function editRecurringSchedule(scheduleId) {
      showNotification(`üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
    }

    function toggleScheduleStatus(scheduleId, newStatus) {
      showNotification(`üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
    }

    function viewScheduleSessions(scheduleId) {
      showNotification(`üîß –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
    }

    function deleteRecurringSchedule(scheduleId) {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ?')) {
        showNotification(`üîß –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Ç—å—é—Ç–æ—Ä–∞
    async function loadMyStudents() {
      console.log('üë• –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Ç—å—é—Ç–æ—Ä–∞...');
      const studentsContent = document.getElementById('studentsContent');
      
      if (!studentsContent) {
        console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç studentsContent –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      studentsContent.innerHTML = `
        <div class="loading">
          <span class="loading-spinner"></span>
          –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞—à–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...
        </div>
      `;

      try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ API, –Ω–æ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ç—å—é—Ç–æ—Ä—É
        const response = await fetch('/api/students', {
          headers: { 'x-telegram-id': '618647337' } // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–π –¥–æ—Å—Ç—É–ø
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('‚úÖ –°—Ç—É–¥–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', data.students?.length || 0);
        
        if (!data.students) {
          throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç API: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ students');
        }
        
        // –§–∏–ª—å—Ç—Ä—É–µ–º —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç—å—é—Ç–æ—Ä–∞ (–ø–æ–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ—Ö)
        studentsData = data.students.filter(student => {
          // –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ tutor_id
          return true;
        });
        
        renderStudentsTable(studentsData);
        updateTutorStats();
        
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:', error);
        studentsContent.innerHTML = `
          <div class="error">
            <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
            <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤: ${error.message}</p>
            <button onclick="loadMyStudents()" class="btn-primary">
              –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
          </div>
        `;
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —É—Ä–æ–∫–æ–≤
    async function loadUpcomingLessons() {
      console.log('üìö –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —É—Ä–æ–∫–æ–≤...');
      const lessonsContent = document.getElementById('lessonsContent');
      
      if (!lessonsContent) return;

      lessonsContent.innerHTML = `
        <div class="loading">
          <span class="loading-spinner"></span>
          –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–æ–≤...
        </div>
      `;

      try {
        // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å
        const mockLessons = []; // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        lessonsData = mockLessons;
        renderLessonsList(mockLessons);
        
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤:', error);
        lessonsContent.innerHTML = `
          <div class="error">
            <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
            <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —É—Ä–æ–∫–∏: ${error.message}</p>
          </div>
        `;
      }
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
    function renderStudentsTable(students) {
      const studentsContent = document.getElementById('studentsContent');
      
      if (students.length === 0) {
        studentsContent.innerHTML = `
          <div class="empty-state">
            <span class="emoji" style="font-size: 3em;">üë•</span>
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
            <button onclick="createNewStudent()" class="btn-primary">
              <span class="emoji">‚ûï</span>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞
            </button>
          </div>
        `;
        return;
      }

      studentsContent.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>–°—Ç—É–¥–µ–Ω—Ç</th>
              <th>Telegram</th>
              <th>–Ø–∑—ã–∫</th>
              <th>–ó–∞–Ω—è—Ç–∏—è –±—Ä–æ–Ω–∏—Ä—É—é—Ç—Å—è</th>
              <th>–°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            ${students.map(student => `
              <tr>
                <td>
                  <div class="student-info">
                    <div class="student-name">
                      <a href="student.html?name=${encodeURIComponent(student.name)}">
                        ${student.name}
                      </a>
                    </div>
                    ${student.email ? `
                      <div class="student-email">
                        ${student.email}
                      </div>
                    ` : ''}
                  </div>
                </td>
                <td class="telegram-column">
                  ${student.username ? `
                    <a href="https://t.me/${student.username}" target="_blank" class="telegram-link">
                      @${student.username}
                    </a>
                  ` : '<span class="no-telegram">‚Äî</span>'}
                </td>
                <td>
                  <span class="language-badge">
                    ${student.language || '‚Äî'}
                  </span>
                  ${student.frequency ? `<br><small class="frequency-info">${student.frequency}x –≤ –Ω–µ–¥–µ–ª—é</small>` : ''}
                </td>
                <td>
                  <div class="booking-mode-info">
                    <span class="booking-badge ${student.booking_mode === 'by_student' ? 'student' : 'teacher'}">
                      ${student.booking_mode === 'by_student' ? 'üë§ –°—Ç—É–¥–µ–Ω—Ç–æ–º' : 'üë©‚Äçüè´ –¢—å—é—Ç–æ—Ä–æ–º'}
                    </span>
                    ${student.booking_mode !== 'by_student' && (student.preferred_time || (student.preferred_days && student.preferred_days.length > 0)) ? `
                      <small class="booking-details">
                        ${student.preferred_days && student.preferred_days.length > 0 ? student.preferred_days.join(', ') : ''}
                        ${student.preferred_time ? ` –≤ ${student.preferred_time}` : ''}
                      </small>
                    ` : ''}
                  </div>
                </td>
                <td>
                  ${student.next_session 
                    ? `<div class="next-lesson">
                         <a href="lesson.html?session_id=${student.next_session_id}" class="lesson-link">
                           ${student.next_session}
                         </a>
                         <small class="lesson-status">${student.status || '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω'}</small>
                       </div>`
                    : '<span class="no-lesson">–ù–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</span>'
                  }
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="action-btn" onclick="scheduleLesson('${student.name}')" title="–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–∫">
                      üìÖ
                    </button>
                    <button class="action-btn" onclick="viewProgress('${student.name}')" title="–ü—Ä–æ–≥—Ä–µ—Å—Å">
                      üìä
                    </button>
                  </div>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ —É—Ä–æ–∫–æ–≤
    function renderLessonsList(lessons) {
      const lessonsContent = document.getElementById('lessonsContent');
      
      if (lessons.length === 0) {
        lessonsContent.innerHTML = `
          <div class="empty-state">
            <span class="emoji" style="font-size: 3em;">üìÖ</span>
            <p>–ó–∞–Ω—è—Ç–∏—è –Ω–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã</p>
            <p style="font-size: 12px; opacity: 0.7;">–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ —É—Ä–æ–∫–∏ –¥–ª—è —Å–≤–æ–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>
          </div>
        `;
        return;
      }

      lessonsContent.innerHTML = `
        <div class="lessons-grid">
          ${lessons.slice(0, 6).map(lesson => `
            <div class="lesson-card ${lesson.status}">
              <div class="lesson-header">
                <span class="lesson-time">
                  ${lesson.date.toLocaleDateString('ru-RU', { 
                    day: '2-digit', 
                    month: '2-digit',
                    weekday: 'short'
                  })}
                  ${lesson.date.toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit'
                  })}
                </span>
                <span class="lesson-duration">${lesson.duration} –º–∏–Ω</span>
              </div>
              
              <div class="lesson-body">
                <h4 class="lesson-student">${lesson.student}</h4>
                <div class="lesson-details">
                  <span class="lesson-language">${lesson.language}</span>
                  <span class="lesson-type">${lesson.type}</span>
                </div>
              </div>
              
              <div class="lesson-actions">
                <button class="lesson-btn primary" onclick="startLesson('${lesson.id}')">
                  ${lesson.status === 'upcoming' ? '‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å' : 'üìù –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å'}
                </button>
                <button class="lesson-btn secondary" onclick="editLesson('${lesson.id}')">
                  ‚úèÔ∏è
                </button>
              </div>
            </div>
          `).join('')}
        </div>
        
        ${lessons.length > 6 ? `
          <div class="show-more">
            <button onclick="showAllLessons()" class="btn-secondary">
              –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —É—Ä–æ–∫–∏ (${lessons.length})
            </button>
          </div>
        ` : ''}
      `;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—å—é—Ç–æ—Ä–∞
    function updateTutorStats() {
      console.log('üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—å—é—Ç–æ—Ä–∞');
      
      const myStudents = studentsData.length;
      const todayLessons = lessonsData.filter(l => {
        const today = new Date();
        return l.date && l.date.toDateString() === today.toDateString();
      }).length;
      
      const weekLessons = lessonsData.filter(l => {
        const today = new Date();
        const weekStart = new Date(today.setDate(today.getDate() - today.getDay()));
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekStart.getDate() + 6);
        return l.date && l.date >= weekStart && l.date <= weekEnd;
      }).length;
      
      const recurringSchedulesCount = recurringData.filter(r => r.is_active).length;
      
      // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      const myStudentsEl = document.getElementById('myStudents');
      const todayLessonsEl = document.getElementById('todayLessons');
      const weekLessonsEl = document.getElementById('weekLessons');
      const recurringSchedulesEl = document.getElementById('recurringSchedules');
      
      if (myStudentsEl) myStudentsEl.textContent = myStudents;
      if (todayLessonsEl) todayLessonsEl.textContent = todayLessons;
      if (weekLessonsEl) weekLessonsEl.textContent = weekLessons;
      if (recurringSchedulesEl) recurringSchedulesEl.textContent = recurringSchedulesCount;
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π
    function createNewStudent() {
      showNotification('üîß –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    }

    function scheduleLesson(studentName) {
      showNotification(`üîß –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞ –¥–ª—è ${studentName} –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
    }

    function viewProgress(studentName) {
      window.location.href = `student.html?name=${encodeURIComponent(studentName)}`;
    }

    function filterLessons() {
      const filter = document.getElementById('lessonsFilter').value;
      console.log('–§–∏–ª—å—Ç—Ä —É—Ä–æ–∫–æ–≤:', filter);
      showNotification('üîß –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É—Ä–æ–∫–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    }

    function startLesson(lessonId) {
      showNotification(`üîß –ù–∞—á–∞–ª–æ —É—Ä–æ–∫–∞ ${lessonId} –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
    }

    function editLesson(lessonId) {
      showNotification(`üîß –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞ ${lessonId} –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`, 'info');
    }

    function showAllLessons() {
      showNotification('üîß –ü–æ–∫–∞–∑ –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    }

// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: ${type === 'success' ? 'var(--success-color)' :
                 type === 'error' ? 'var(--error-color)' :
                 type === 'warning' ? '#ff9800' : 'var(--accent-color)'};
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    max-width: 300px;
    font-size: 13px;
    animation: slideInRight 0.3s ease-out;
    line-height: 1.4;
  `;

  // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏—é –µ—Å–ª–∏ –µ—ë –µ—â—ë –Ω–µ—Ç
  if (!document.getElementById('notificationStyles')) {
    const style = document.createElement('style');
    style.id = 'notificationStyles';
    style.textContent = `
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  }

  notification.textContent = message;
  document.body.appendChild(notification);

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
  setTimeout(() => {
    if (document.body.contains(notification)) {
      notification.style.animation = 'slideOutRight 0.3s ease-out';
      setTimeout(() => {
        if (document.body.contains(notification)) {
          document.body.removeChild(notification);
        }
      }, 300);
    }
  }, 3000);
}



console.log('‚úÖ –ü–∞–Ω–µ–ª—å —Ç—å—é—Ç–æ—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
    </script>
</body>
</html>
